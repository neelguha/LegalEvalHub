{% extends "base.html" %}

{% block title %}{{ preset_data.name }} - LegalEvalHub{% endblock %}

{% block content %}
<article class="documentation">
    <h2>{{ preset_data.name }}</h2>
    
    {{ preset_data.description }}
    <br>
    <br>
    <p class="note"><em>Note: Only models that have been evaluated on all {{ selected_tasks|length }} tasks in this preset are included in the leaderboard.</em></p>
    <br>
    {% if leaderboard %}
    <table>
        <thead>
            <tr>
                <th>Rank</th>
                <th>Model</th>
                <th>Wins</th>
                <th>Average Rank</th>
                <th>Raw Metric Avg</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for entry in leaderboard %}
            <tr class="model-row" data-model-index="{{ loop.index0 }}">
                <td>{{ loop.index }}</td>
                <td class="model-name">{{ entry.model }}</td>
                <td><strong>{{ entry.wins }}</strong></td>
                <td>{{ "%.2f"|format(entry.avg_rank) }}</td>
                <td>{{ "%.4f"|format(entry.avg_raw_metric) }}</td>
                <td><span class="expand-icon">â–¶</span></td>
            </tr>
            <tr class="detail-row" id="details-{{ loop.index0 }}" style="display: none;">
                <td colspan="6">
                    <div class="task-breakdown">
                        <h4>Task-by-Task Performance for {{ entry.model }}</h4>
                        <table class="task-detail-table">
                            <thead>
                                <tr>
                                    <th>Task</th>
                                    <th>Rank</th>
                                    <th>Score</th>
                                    <th>Metric</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for run in entry.runs %}
                                <tr>
                                    <td><a href="{{ url_for('task_detail', task_id=run.task_id) }}">{{ run.task_name }}</a></td>
                                    <td class="rank">{{ run.rank }}</td>
                                    <td class="metric-value">{{ "%.4f"|format(run.score) }}</td>
                                    <td class="small">{{ run.metric }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="text-muted">No evaluation results available for this preset yet.</p>
    {% endif %}

    <h2>Tasks in This Benchmark</h2>
    
    <ul class="task-list">
        {% for task in selected_tasks %}
        <li><a href="{{ url_for('task_detail', task_id=task.task_id) }}">{{ task.name }}</a></li>
        {% endfor %}
    </ul>
</article>

<style>
.note {
    background-color: #e8f4f8;
    border-left: 4px solid #0066cc;
    padding: 0.75rem 1rem;
    margin: 1rem 0;
    font-size: 0.95rem;
}

.lead {
    font-size: 1.2em;
    color: #333;
    margin-bottom: 1.5rem;
}

.preset-info {
    background: #f5f5f5;
    padding: 1rem;
    border-radius: 5px;
    margin-bottom: 2rem;
}

.task-list {
    list-style-type: disc;
    padding-left: 1.5rem;
    margin: 1rem 0;
}

.task-list li {
    margin-bottom: 0.5rem;
    line-height: 1.6;
}

.preset-navigation {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1rem;
    margin: 1.5rem 0;
}

.preset-nav-item {
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 5px;
}

.preset-nav-item:hover {
    background: #f5f5f5;
}

.cta-section {
    margin-top: 3rem;
    padding: 1.5rem;
    background: #f0f7ff;
    border: 1px solid #0066cc;
    border-radius: 5px;
    text-align: center;
}

/* Expandable row styles */
.model-row {
    cursor: pointer;
}

.model-row:hover {
    background-color: #f5f5f5;
}

.expand-icon {
    transition: transform 0.2s;
    display: inline-block;
    font-size: 0.8em;
}

.model-row.expanded .expand-icon {
    transform: rotate(90deg);
}

.detail-row {
    background-color: #f8f9fa;
}

.task-breakdown {
    padding: 1rem;
}

.task-breakdown h4 {
    margin: 0 0 1rem 0;
    font-size: 1.1rem;
    color: #333;
}

.task-detail-table {
    margin: 0;
    font-size: 0.9rem;
}

.task-detail-table th {
    background-color: #e9ecef;
    font-size: 0.85rem;
}

.task-detail-table td {
    padding: 0.5rem;
}

.task-detail-table .rank {
    text-align: center;
    font-weight: 600;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const modelRows = document.querySelectorAll('.model-row');
    
    modelRows.forEach(function(row) {
        row.addEventListener('click', function() {
            const modelIndex = this.getAttribute('data-model-index');
            const detailRow = document.getElementById('details-' + modelIndex);
            const expandIcon = this.querySelector('.expand-icon');
            
            if (detailRow.style.display === 'none') {
                detailRow.style.display = 'table-row';
                this.classList.add('expanded');
            } else {
                detailRow.style.display = 'none';
                this.classList.remove('expanded');
            }
        });
    });
});
</script>
{% endblock %}